<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Quản lý Chấm công</title>

    <link rel="stylesheet" href="./assets/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="./assets/css/styles.css" />
    <link rel="stylesheet" href="./assets/css/cham-cong.css" />
  </head>

  <body class="bg">
    <div id="menuContainer"></div>

    <main class="container">
      <div class="page-header">
        <h1 class="page-title">Quản lý chấm công</h1>
      </div>

      <!-- TAB MENU -->
      <div class="cc-tabs-container">
        <button class="cc-tab-btn active" data-tab="cham-cong-tab">
          <i class="fa-solid fa-clock" style="color: #36b9cc"></i> Chấm công
        </button>
        <button class="cc-tab-btn" data-tab="thuong-phat-tab">
          <i class="fa-solid fa-money-bill-wave" style="color: #e74a3b"></i>
          Thưởng phạt
        </button>
      </div>

      <!-- TAB 1: CHẤM CÔNG -->
      <section id="cham-cong-tab" class="tab-content active cc-tab-content">
        <div class="cc-toolbar">
          <div class="cc-toolbar-group">
            <input
              id="nvId"
              type="number"
              placeholder="ID NV"
              style="width: 90px"
            />
            <input id="nvName" type="text" placeholder="Tên nhân viên" />
            <select id="phongBanFilter">
              <option value="">-- Phòng ban --</option>
            </select>
            <select id="statusFilter">
              <option value="">-- Trạng thái --</option>
              <option value="di_lam">Đi làm</option>
              <option value="di_muon">Đi muộn</option>
              <option value="ve_som">Về sớm</option>
              <option value="nghi_phep">Nghỉ phép</option>
              <option value="nghi_khong_phep">Nghỉ không phép</option>
            </select>
          </div>

          <div class="cc-toolbar-group">
            <span class="text-muted" style="font-size: 13px">Từ:</span>
            <input id="from" type="date" />
            <span class="text-muted" style="font-size: 13px">Đến:</span>
            <input id="to" type="date" />
          </div>

          <div class="cc-toolbar-actions">
            <button id="btn-search" class="btn btn-secondary">
              <i
                class="fa-solid fa-magnifying-glass"
                style="color: #858796"
              ></i>
              Lọc
            </button>
            <button id="btn-refresh" class="btn btn-secondary">
              <i class="fa-solid fa-rotate-right" style="color: #4e73df"></i>
              Tải lại
            </button>
            <button
              id="btn-auto-process"
              class="btn btn-warning"
              style="display: none"
            >
              <i class="fa fa-magic"></i> Chạy tự động
            </button>
            <button id="btn-create" class="btn btn-primary">
              <i class="fa-solid fa-plus" style="color: #1cc88a"></i> Thêm mới
            </button>

            <label class="btn btn-secondary" title="Upload Excel">
              <i class="fa-solid fa-file-export" style="color: #20c997"></i>
              Upload
              <input type="file" id="fileExcel" accept=".xlsx,.xls" hidden />
            </label>
            <button id="btn-export" class="btn btn-success-outline">
              <i class="fa-solid fa-chart-column" style="color: #6f42c1"></i>
              Xuất Excel
            </button>
          </div>
        </div>

        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nhân viên</th>
                <th>Ngày</th>
                <th>Check-in</th>
                <th>Check-out</th>
                <th>Trạng thái</th>
                <th>Loại ngày</th>
                <th>Ghi chú</th>
                <th>Thao tác</th>
              </tr>
            </thead>
            <tbody id="tbody">
              <tr>
                <td colspan="9" class="text-muted">Đang tải…</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pagination">
          <button id="prev" class="page-btn">«</button>
          <span id="pageInfo" class="text-muted">Trang 1/1</span>
          <button id="next" class="page-btn">»</button>
        </div>
      </section>

      <!-- TAB 3: THƯỞNG PHẠT -->
      <section id="thuong-phat-tab" class="tab-content cc-tab-content">
        <div class="cc-header-row">
          <h2>
            <i class="fa-solid fa-money-bill-wave" style="color: #e74a3b"></i>
            Quản lý thưởng phạt
          </h2>
        </div>

        <!-- ===== KHỐI A: THÊM THƯỞNG PHẠT CHO NHÂN VIÊN ===== -->
        <div
          id="tp-block-nhanvien"
          class="cc-box-highlight"
          style="margin-bottom: 12px"
        >
          <h3 style="margin-top: 0">Thưởng / Phạt theo NHÂN VIÊN</h3>
          <div class="cc-flex-row">
            <!-- Typeahead nhân viên sẽ được JS chèn ở đây -->
            <span id="tp-nv-typeahead-placeholder"></span>

            <select id="tp-phong-ban-A">
              <option value="">-- Chọn phòng ban --</option>
            </select>
            <select id="tp-loai-nv" style="min-width: 100px">
              <option value="THUONG">Thưởng</option>
              <option value="PHAT">Phạt</option>
            </select>
            <input
              id="tp-so-tien-nv"
              type="number"
              step="1000"
              placeholder="Số tiền (VNĐ)"
            />
            <input
              id="tp-ly-do-nv"
              type="text"
              placeholder="Lý do..."
              style="flex-grow: 2"
            />
          </div>

          <div class="cc-flex-row mt-2">
            <select id="tp-thang-nv">
              <option value="">-- Tháng --</option>
            </select>
            <select id="tp-nam-nv">
              <option value="">-- Năm --</option>
            </select>
            <!-- chỉ dùng để lọc danh sách bên dưới theo NV -->
            <button id="btn-filter-nv" class="btn btn-secondary">
              Lọc theo nhân viên
            </button>
            <button id="btn-tp-add-nv" class="btn btn-primary">
              Thêm cho NHÂN VIÊN
            </button>
          </div>
        </div>

        <!-- ===== KHỐI B: THÊM THƯỞNG PHẠT CHO PHÒNG BAN ===== -->
        <div
          id="tp-block-phongban"
          class="cc-box-highlight"
          style="margin-bottom: 16px"
        >
          <h3 style="margin-top: 0">Thưởng / Phạt theo PHÒNG BAN</h3>
          <div class="cc-flex-row">
            <select id="tp-phong-ban">
              <option value="">-- Chọn phòng ban --</option>
            </select>
            <select id="tp-loai-pb" style="min-width: 100px">
              <option value="THUONG">Thưởng</option>
              <option value="PHAT">Phạt</option>
            </select>
            <input
              id="tp-so-tien-pb"
              type="number"
              step="1000"
              placeholder="Số tiền (VNĐ)"
            />
            <input
              id="tp-ly-do-pb"
              type="text"
              placeholder="Lý do..."
              style="flex-grow: 2"
            />
          </div>

          <div class="cc-flex-row mt-2">
            <select id="tp-thang-pb">
              <option value="">-- Tháng --</option>
            </select>
            <select id="tp-nam-pb">
              <option value="">-- Năm --</option>
            </select>
            <button id="btn-filter-pb" class="btn btn-secondary">
              Lọc theo phòng ban
            </button>
            <button id="btn-tp-add-pb" class="btn btn-primary">
              Thêm cho PHÒNG BAN
            </button>
            <button id="btn-export-tp" class="btn btn-success-outline">
              <i class="fa-solid fa-chart-column" style="color: #6f42c1"></i>
              Xuất
            </button>
          </div>
        </div>

        <!-- BẢNG DANH SÁCH -->
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nhân viên</th>
              <th>Loại</th>
              <th>Số tiền</th>
              <th>Lý do</th>
              <th>Ngày tạo</th>
              <th>Người tạo</th>
              <th>Phòng ban</th>
              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody id="tbody-tp">
            <tr>
              <td colspan="9" class="text-muted">Đang tải…</td>
            </tr>
          </tbody>
        </table>

        <div class="pagination" id="tp-pagination">
          <button id="tp-prev" class="page-btn">«</button>
          <span id="tp-pageInfo" class="text-muted">Trang 1/1</span>
          <button id="tp-next" class="page-btn">»</button>
        </div>
      </section>

      <dialog id="modal" style="max-width: 1050px; width: 98%">
        <form id="form" method="dialog" class="form" style="padding: 0">
          <div
            style="
              padding: 16px 24px;
              background: #f8fafc;
              border-bottom: 1px solid #e2e8f0;
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div>
              <h3
                style="
                  margin: 0;
                  padding: 0;
                  background: transparent;
                  border: none;
                  font-size: 18px;
                  color: var(--primary);
                "
              >
                Cập nhật chấm công
              </h3>
              <small class="text-muted"
                >Nhập ID <b>hoặc</b> Tên để tự động điền thông tin</small
              >
            </div>
            <button
              type="button"
              id="btn-add-row"
              class="btn btn-primary btn-sm"
            >
              + Thêm dòng
            </button>
          </div>

          <div style="padding: 0; overflow-x: auto; max-height: 65vh">
            <table class="batch-table">
              <thead>
                <tr>
                  <th style="width: 80px">ID</th>
                  <th style="width: 220px">Tên Nhân viên (Gõ để tìm)</th>
                  <th style="width: 130px">Ngày</th>
                  <th style="width: 90px">Vào</th>
                  <th style="width: 90px">Ra</th>
                  <th style="width: 130px">Trạng thái</th>
                  <th style="width: 100px">Loại ngày</th>
                  <th>Ghi chú</th>
                  <th style="width: 40px"></th>
                </tr>
              </thead>
              <tbody id="batch-tbody">
                <!-- JS sẽ render các dòng nhập liệu ở đây -->
              </tbody>
            </table>
          </div>

          <div
            id="modal-error"
            class="alert alert-error"
            style="margin: 10px 24px"
            hidden
          ></div>

          <div
            class="modal-actions"
            style="
              padding: 16px 24px;
              margin-top: 0;
              background: #fff;
              border-top: 1px solid #e2e8f0;
            "
          >
            <button id="btn-cancel" type="button" class="btn btn-secondary">
              Hủy bỏ
            </button>
            <button id="btn-save" type="submit" class="btn btn-primary">
              <i class="fa-solid fa-floppy-disk" style="color: #f6c23e"></i>
              Lưu tất cả
            </button>
          </div>
        </form>
      </dialog>
    </main>

    <footer class="footer">
      <div class="container">
        <small>© <span id="y"></span> HR System</small>
      </div>
    </footer>

    <script src="./assets/js/danh-sach.js"></script>
    <script type="module" src="./assets/js/cham-cong.js"></script>
    <script type="module" src="./assets/js/thuong-phat.js"></script>
    <script type="module" src="./assets/js/navbar.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const tabs = document.querySelectorAll('.cc-tab-btn');
        const sections = document.querySelectorAll('.cc-tab-content');
        tabs.forEach((tab) => {
          tab.addEventListener('click', () => {
            tabs.forEach((t) => t.classList.remove('active'));
            sections.forEach((s) => s.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.tab)?.classList.add('active');
          });
        });
      });
    </script>
  </body>
</html>
